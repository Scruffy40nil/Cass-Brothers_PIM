<!-- Taps Edit Modal -->
<div class="modal fade edit-modal" id="editProductModal" tabindex="-1">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title d-flex align-items-center">
          <i class="fas fa-edit me-2"></i>Edit Tap - <span id="editProductTitle">Product</span>
          <span id="modalStatusBadge" class="badge bg-secondary ms-3" style="display: none;">Ready</span>
          <span id="liveUpdatesBadge" class="badge bg-success ms-2" style="display: none;">
            <i class="fas fa-wifi me-1"></i>Live Updates
          </span>
        </h5>
        <div class="modal-header-actions">
          <button type="button" class="btn btn-ai-extract btn-sm me-2" onclick="extractCurrentProductImages(event)" title="Extract Images for This Product">
            <i class="fas fa-images me-1"></i>Extract Images
          </button>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
      </div>

      <div class="modal-body" style="max-height: 70vh; overflow-y: auto;">
        <!-- Pricing Comparison Section -->
        {% if collection_config.pricing_enabled %}
        <div class="pricing-section mb-4">
          <h6><i class="fas fa-dollar-sign me-2"></i>Pricing Comparison</h6>
          <div class="row">
            <div class="col-md-4">
              <div class="pricing-card">
                <div class="pricing-icon">
                  <i class="fas fa-store"></i>
                </div>
                <span class="pricing-label">Our Price</span>
                <div class="pricing-amount" id="ourCurrentPrice">$0.00</div>
                <div class="pricing-status" id="ourPriceStatus">Current pricing</div>
              </div>
            </div>
            <div class="col-md-4">
              <div class="pricing-card">
                <div class="pricing-icon">
                  <i class="fas fa-building"></i>
                  <span class="pricing-label" id="competitorLabel">Competitor</span>
                </div>
                <div class="pricing-amount" id="competitorPrice">$0.00</div>
                <div class="pricing-status">Market comparison</div>
              </div>
            </div>
            <div class="col-md-4">
              <div class="pricing-card" id="priceDifferenceCard">
                <div class="pricing-icon">
                  <i class="fas fa-chart-line"></i>
                </div>
                <span class="pricing-label">Difference</span>
                <div class="pricing-amount" id="priceDifference">$0.00</div>
                <div class="pricing-status">vs competitor</div>
              </div>
            </div>
          </div>
        </div>
        {% endif %}

        <!-- Image Gallery Section -->
        <div class="image-section mb-4">
          <h6>
            <i class="fas fa-images me-2"></i>Product Images
            <span class="image-count-badge" id="modalImageCountBadge">0 images</span>
          </h6>

          <div class="main-image-container" id="modalMainImageContainer">
              <div class="image-placeholder" id="modalImagePlaceholder">
                  <i class="fas fa-image"></i>
                  <p>No image available</p>
              </div>

              <button class="image-nav-btn prev" id="modalPrevImageBtn" onclick="navigateModalImage(-1)" style="display: none;">
                  <i class="fas fa-chevron-left"></i>
              </button>
              <button class="image-nav-btn next" id="modalNextImageBtn" onclick="navigateModalImage(1)" style="display: none;">
                  <i class="fas fa-chevron-right"></i>
              </button>

              <div class="image-counter" id="modalImageCounter" style="display: none;">
                  <span id="modalCurrentImageIndex">1</span> / <span id="modalTotalImages">1</span>
              </div>
          </div>

          <div class="thumbnail-gallery" id="modalThumbnailGallery" style="display: none;">
              <!-- Thumbnails will be dynamically populated -->
          </div>
        </div>

        <!-- Product Form -->
        <form id="editProductForm">
          <!-- Basic Information -->
          <div class="field-group" id="basicInfoGroup">
            <h6><i class="fas fa-info-circle me-2"></i>Basic Information</h6>
            <div class="row">
              <div class="col-md-4">
                <div class="mb-3">
                  <label class="form-label">SKU</label>
                  <input type="text" class="form-control" id="editSku" placeholder="Product SKU">
                </div>
              </div>
              <div class="col-md-4">
                <div class="mb-3">
                  <label class="form-label">Product Title</label>
                  <input type="text" class="form-control" id="editTitle" placeholder="Product Title">
                </div>
              </div>
              <div class="col-md-4">
                <div class="mb-3">
                  <label class="form-label">Vendor/Brand</label>
                  <input type="text" class="form-control" id="editVendor" placeholder="Vendor Name">
                </div>
              </div>
            </div>
          </div>

          <!-- Tap Specifications -->
          <div class="field-group" id="tapsSpecsGroup">
            <h6><i class="fas fa-faucet me-2"></i>Tap Specifications</h6>
            <div class="row">
              <div class="col-md-4">
                <div class="mb-3">
                  <label class="form-label">Tap Type</label>
                  <select class="form-control" id="editTapType">
                    <option value="">Select...</option>
                    <option value="Kitchen Mixer">Kitchen Mixer</option>
                    <option value="Basin Mixer">Basin Mixer</option>
                    <option value="Bath Mixer">Bath Mixer</option>
                    <option value="Shower Mixer">Shower Mixer</option>
                  </select>
                </div>
              </div>
              <div class="col-md-4">
                <div class="mb-3">
                  <label class="form-label">Material</label>
                  <select class="form-control" id="editTapMaterial">
                    <option value="">Select...</option>
                    <option value="Brass">Brass</option>
                    <option value="Stainless Steel">Stainless Steel</option>
                    <option value="Zinc">Zinc</option>
                    <option value="Ceramic">Ceramic</option>
                  </select>
                </div>
              </div>
              <div class="col-md-4">
                <div class="mb-3">
                  <label class="form-label">Finish</label>
                  <select class="form-control" id="editFinish">
                    <option value="">Select...</option>
                    <option value="Chrome">Chrome</option>
                    <option value="Brushed Nickel">Brushed Nickel</option>
                    <option value="Matte Black">Matte Black</option>
                    <option value="Gold">Gold</option>
                    <option value="Copper">Copper</option>
                  </select>
                </div>
              </div>
            </div>
            <div class="row">
              <div class="col-md-4">
                <div class="mb-3">
                  <label class="form-label">Mounting Type</label>
                  <select class="form-control" id="editMountingType">
                    <option value="">Select...</option>
                    <option value="Deck Mounted">Deck Mounted</option>
                    <option value="Wall Mounted">Wall Mounted</option>
                    <option value="Floor Mounted">Floor Mounted</option>
                  </select>
                </div>
              </div>
              <div class="col-md-4">
                <div class="mb-3">
                  <label class="form-label">Handle Type</label>
                  <select class="form-control" id="editHandleType">
                    <option value="">Select...</option>
                    <option value="Single Handle">Single Handle</option>
                    <option value="Dual Handle">Dual Handle</option>
                    <option value="Lever">Lever</option>
                    <option value="Cross">Cross</option>
                  </select>
                </div>
              </div>
              <div class="col-md-4">
                <div class="mb-3">
                  <label class="form-label">Spout Type</label>
                  <select class="form-control" id="editSpoutType">
                    <option value="">Select...</option>
                    <option value="Fixed">Fixed</option>
                    <option value="Swivel">Swivel</option>
                    <option value="Pull-out">Pull-out</option>
                    <option value="Pull-down">Pull-down</option>
                  </select>
                </div>
              </div>
            </div>
          </div>

          <!-- Tap Dimensions & Performance -->
          <div class="field-group" id="tapDimensionsGroup">
            <h6><i class="fas fa-ruler me-2"></i>Dimensions & Performance</h6>
            <div class="row">
              <div class="col-md-3">
                <div class="mb-3">
                  <label class="form-label">Height (mm)</label>
                  <input type="number" class="form-control" id="editHeightMm" placeholder="Height">
                </div>
              </div>
              <div class="col-md-3">
                <div class="mb-3">
                  <label class="form-label">Spout Reach (mm)</label>
                  <input type="number" class="form-control" id="editSpoutReachMm" placeholder="Spout reach">
                </div>
              </div>
              <div class="col-md-3">
                <div class="mb-3">
                  <label class="form-label">Flow Rate (L/min)</label>
                  <input type="number" step="0.1" class="form-control" id="editWaterFlowRate" placeholder="Flow rate">
                </div>
              </div>
              <div class="col-md-3">
                <div class="mb-3">
                  <label class="form-label">Weight (kg)</label>
                  <input type="number" step="0.1" class="form-control" id="editWeightKg" placeholder="Weight">
                </div>
              </div>
            </div>
            <div class="row">
              <div class="col-md-4">
                <div class="mb-3">
                  <label class="form-label">Pressure Rating</label>
                  <input type="text" class="form-control" id="editPressureRating" placeholder="e.g., 150-500 kPa">
                </div>
              </div>
              <div class="col-md-4">
                <div class="mb-3">
                  <label class="form-label">Valve Type</label>
                  <select class="form-control" id="editValveType">
                    <option value="">Select...</option>
                    <option value="Ceramic Disc">Ceramic Disc</option>
                    <option value="Ball Valve">Ball Valve</option>
                    <option value="Cartridge">Cartridge</option>
                  </select>
                </div>
              </div>
              <div class="col-md-4">
                <div class="mb-3">
                  <label class="form-label">Warranty (Years)</label>
                  <input type="number" class="form-control" id="editWarrantyYears" placeholder="Years">
                </div>
              </div>
            </div>
          </div>

          <!-- Pricing Information -->
          <div class="field-group" id="pricingGroup">
            <h6><i class="fas fa-dollar-sign me-2"></i>Pricing Information</h6>
            <div class="row">
              <div class="col-md-6">
                <div class="mb-3">
                  <label class="form-label">RRP Price ($)</label>
                  <input type="number" step="0.01" class="form-control" id="editRrpPrice" placeholder="Recommended Retail Price">
                </div>
              </div>
              <div class="col-md-6">
                <div class="mb-3">
                  <label class="form-label">Sale Price ($)</label>
                  <input type="number" step="0.01" class="form-control" id="editSalePrice" placeholder="Current Sale Price">
                </div>
              </div>
            </div>
          </div>

          <!-- SEO Information -->
          <div class="field-group" id="seoGroup">
            <h6><i class="fas fa-search me-2"></i>SEO Information</h6>
            <div class="row">
              <div class="col-md-6">
                <div class="mb-3">
                  <label class="form-label">SEO Title</label>
                  <input type="text" class="form-control" id="editSeoTitle" placeholder="SEO optimized title">
                </div>
              </div>
              <div class="col-md-6">
                <div class="mb-3">
                  <label class="form-label">SEO Description</label>
                  <textarea class="form-control" id="editSeoDescription" rows="3" placeholder="SEO description"></textarea>
                </div>
              </div>
            </div>
          </div>

          <!-- Product Description -->
          <div class="field-group" id="descriptionGroup">
            <h6><i class="fas fa-file-text me-2"></i>Product Content</h6>
            <div class="mb-3">
              <label class="form-label">Product Description (HTML)</label>
              <div class="position-relative">
                  <textarea class="form-control" id="editBodyHtml" rows="4" placeholder="HTML product description"></textarea>
                  <button type="button" class="btn btn-ai-description btn-sm position-absolute top-0 end-0 m-2" onclick="generateAIDescription(event)">
                      <i class="fas fa-magic me-1"></i>AI Generate
                  </button>
              </div>
            </div>
            <div class="mb-3">
              <label class="form-label">Features</label>
              <div class="position-relative">
                  <textarea class="form-control" id="editFeatures" rows="5" placeholder="5 key product features and benefits (click AI Generate for intelligent suggestions)"></textarea>
                  <button type="button" class="btn btn-ai-description btn-sm position-absolute top-0 end-0 m-2" onclick="generateAIFeatures(event)">
                      <i class="fas fa-magic me-1"></i>AI Generate
                  </button>
              </div>
            </div>
            <div class="mb-3">
              <label class="form-label">Care Instructions</label>
              <textarea class="form-control" id="editCareInstructions" rows="2" placeholder="Care and maintenance instructions"></textarea>
            </div>
          </div>
        </form>
      </div>

      <div class="modal-footer">
        <button type="button" class="btn btn-primary" onclick="saveProduct()">
          <i class="fas fa-save me-1"></i>Save Changes
        </button>
      </div>
    </div>
  </div>
</div>
<!-- Sinks Edit Modal -->
<div class="modal fade edit-modal" id="editProductModal" tabindex="-1">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title d-flex align-items-center">
          <i class="fas fa-edit me-2"></i>Edit Sink - <span id="editProductTitle">Product</span>
        </h5>

        <!-- Simple Data Quality Section - At very top -->
        <div class="data-quality-header-top mt-2">
          <div class="quality-score-display">
            <div class="quality-main-info">
              <span class="quality-label">Data Completion:</span>
              <div class="quality-progress-container">
                <div class="progress quality-progress">
                  <div class="progress-bar" id="modalQualityProgressBar" role="progressbar" style="width: 0%"></div>
                </div>
                <span class="quality-percentage" id="modalQualityPercentage">0%</span>
              </div>
            </div>
          </div>
        </div>
        <div class="modal-header-actions">
          <button type="button" class="btn btn-success btn-sm me-2" onclick="console.log('🖱️ Save button clicked!'); saveProduct();" title="Save all changes to Google Sheets">
            <i class="fas fa-save me-1"></i>Save Changes
          </button>
          <button type="button" class="btn btn-ai-extract btn-sm me-2" onclick="extractSingleProductWithStatus(event)" title="AI Extract This Product">
            <i class="fas fa-robot me-1"></i>AI Extract
          </button>
          <button type="button" class="btn btn-primary btn-sm me-2" onclick="extractCurrentProductImages(event)" title="Extract Images for This Product">
            <i class="fas fa-images me-1"></i>Extract Images
          </button>
          <button type="button" class="btn btn-outline-primary btn-sm me-2" id="compareButton" onclick="openCompareWindow()" style="display: none;">
            <i class="fas fa-external-link-alt me-1"></i>Compare
          </button>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
      </div>

      <div class="modal-body modal-body-spaced" style="max-height: 70vh; overflow-y: auto;">
        <!-- Pricing Comparison Section -->
        {% if collection_config.pricing_enabled %}
        <div class="pricing-section mb-4">
          <h6><i class="fas fa-dollar-sign me-2"></i>Pricing Comparison</h6>
          <div class="row">
            <div class="col-md-4">
              <div class="pricing-card">
                <div class="pricing-icon">
                  <i class="fas fa-store"></i>
                </div>
                <span class="pricing-label">Our Price</span>
                <div class="pricing-amount" id="ourCurrentPrice">$0.00</div>
                <div class="pricing-status" id="ourPriceStatus">Current pricing</div>
              </div>
            </div>
            <div class="col-md-4">
              <div class="pricing-card">
                <div class="pricing-icon">
                  <i class="fas fa-building"></i>
                  <span class="pricing-label" id="competitorLabel">Competitor</span>
                </div>
                <div class="pricing-amount" id="competitorPrice">$0.00</div>
                <div class="pricing-status">Market comparison</div>
              </div>
            </div>
            <div class="col-md-4">
              <div class="pricing-card" id="priceDifferenceCard">
                <div class="pricing-icon">
                  <i class="fas fa-chart-line"></i>
                </div>
                <span class="pricing-label">Difference</span>
                <div class="pricing-amount" id="priceDifference">$0.00</div>
                <div class="pricing-status">vs competitor</div>
              </div>
            </div>
          </div>
        </div>
        {% endif %}

        <!-- Spec Sheet Verification Section -->
        <div class="spec-sheet-section mb-4">
          <h6 class="d-flex align-items-center justify-content-between">
            <span>
              <i class="fas fa-file-pdf me-2"></i>Spec Sheet Verification
            </span>
            <span class="badge bg-info ms-2" id="specSheetStatus">No spec sheet</span>
          </h6>

          <!-- URL Input Option -->
          <div class="spec-url-section mb-3">
            <label class="form-label">
              <i class="fas fa-link me-1"></i>Spec Sheet URL
            </label>
            <div class="input-group">
              <input type="url" class="form-control" id="editShopifySpecSheet" placeholder="https://example.com/path/to/spec-sheet.pdf">
              <button type="button" class="btn btn-primary" onclick="validateSpecSheetUrl()">
                <i class="fas fa-check-circle me-1"></i>Validate
              </button>
            </div>
            <div id="specSheetValidationResult" class="mt-2" style="display: none;"></div>
            <small class="text-muted">Enter a spec sheet URL to validate accessibility and SKU matching</small>
          </div>
        </div>

        <!-- Additional Images Section -->
        <div class="additional-images-section mb-4">
          <h6>
            <i class="fas fa-images me-2"></i>Additional Images
            <span class="badge bg-secondary ms-2" id="additionalImagesCount">0 images</span>
          </h6>

          <!-- Current Images Display -->
          <div id="currentImagesList" class="current-images mb-3" style="display: none;">
            <label class="form-label">Current Images:</label>
            <div id="imagePreviewContainer" class="d-flex flex-wrap gap-2">
              <!-- Image previews will be dynamically added here -->
            </div>
          </div>

          <!-- Add New Image -->
          <div class="add-image-section">
            <label class="form-label">
              <i class="fas fa-plus-circle me-1"></i>Add Image URL
            </label>
            <div class="input-group mb-2">
              <input type="url" class="form-control" id="newImageUrl" placeholder="https://example.com/path/to/image.jpg">
              <button type="button" class="btn btn-success" onclick="addNewImage()">
                <i class="fas fa-plus me-1"></i>Add
              </button>
            </div>
            <small class="text-muted">Supported formats: JPG, PNG, WebP. Drag thumbnails to reorder (first image becomes main image).</small>
          </div>

          <!-- Hidden field to store the comma-separated URLs -->
          <input type="hidden" id="editAdditionalImages" value="">
        </div>

        <!-- Additional Images Styles -->
        <style>
          /* AI Generate Button Styling */
          .btn-ai-generate {
            background: linear-gradient(135deg, #6610f2, #6f42c1);
            border: none;
            color: white;
            font-weight: 500;
            padding: 0.375rem 0.75rem;
            border-radius: 0 0.375rem 0.375rem 0;
            transition: all 0.2s ease;
            box-shadow: 0 2px 4px rgba(102, 16, 242, 0.2);
          }

          .btn-ai-generate:hover {
            background: linear-gradient(135deg, #520dc2, #5a37a3);
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(102, 16, 242, 0.3);
            color: white;
          }

          .btn-ai-generate:active {
            transform: translateY(0);
            box-shadow: 0 2px 4px rgba(102, 16, 242, 0.2);
          }

          .btn-ai-generate:disabled {
            background: #6c757d;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
          }

          .btn-ai-generate.generating {
            background: linear-gradient(135deg, #17a2b8, #138496);
            cursor: wait;
          }

          .btn-ai-generate.generating .fa-magic {
            animation: rotate 1s linear infinite;
          }

          @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
          }

          /* Title generation modal styling */
          .title-variant-option {
            padding: 1rem;
            border: 2px solid #dee2e6;
            border-radius: 0.5rem;
            margin-bottom: 0.75rem;
            cursor: pointer;
            transition: all 0.2s ease;
            background: white;
          }

          .title-variant-option:hover {
            border-color: #6610f2;
            background: #f8f9ff;
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(102, 16, 242, 0.1);
          }

          .title-variant-option.selected {
            border-color: #6610f2;
            background: linear-gradient(135deg, #f8f9ff, #e7e3ff);
            box-shadow: 0 4px 12px rgba(102, 16, 242, 0.2);
          }

          .title-variant-text {
            font-weight: 600;
            color: #333;
            margin-bottom: 0.25rem;
          }

          .title-variant-meta {
            font-size: 0.875rem;
            color: #6c757d;
          }

          /* Market research display styling */
          .market-stats .stat-card {
            text-align: center;
            padding: 1rem;
            background: #f8f9fa;
            border-radius: 0.5rem;
            border: 1px solid #dee2e6;
          }

          .stat-number {
            font-size: 1.5rem;
            font-weight: 700;
            color: #0d6efd;
            margin-bottom: 0.25rem;
          }

          .stat-label {
            font-size: 0.75rem;
            color: #6c757d;
            text-transform: uppercase;
            letter-spacing: 0.5px;
          }

          .keyword-tags .badge {
            font-size: 0.75rem;
            padding: 0.4rem 0.6rem;
            border: 1px solid #dee2e6;
          }

          .competitor-title-example {
            font-size: 0.85rem;
            color: #495057;
            background: #f8f9fa;
            padding: 0.5rem;
            border-radius: 0.25rem;
            border-left: 3px solid #0d6efd;
            margin-bottom: 0.5rem;
            font-style: italic;
          }

          .insights-section li {
            margin-bottom: 0.25rem;
            font-size: 0.9rem;
          }

          .competitor-insights h7 {
            font-weight: 600;
            color: #495057;
            font-size: 0.9rem;
            display: block;
            margin-bottom: 0.5rem;
          }

          /* Competitor breakdown styling */
          .competitor-title-item {
            border: 1px solid #e9ecef;
            border-radius: 0.5rem;
            padding: 0.75rem;
            background: #fdfdfe;
          }

          .competitor-name {
            font-weight: 600;
            color: #0d6efd;
            font-size: 0.8rem;
            margin-bottom: 0.25rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
          }

          .competitor-title-text {
            font-size: 0.9rem;
            color: #495057;
            font-style: italic;
            line-height: 1.3;
          }
          .image-preview-card {
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            position: relative;
          }
          .image-preview-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
          }
          .image-preview-card img {
            border-radius: 0.375rem 0.375rem 0 0;
          }
          .image-preview-card .btn-danger {
            opacity: 0.8;
          }
          .image-preview-card .btn-danger:hover {
            opacity: 1;
          }

          /* Drag and drop styles */
          .image-preview-card[draggable="true"] {
            user-select: none;
          }
          .image-preview-card[draggable="true"]:hover .drag-handle {
            opacity: 1;
          }
          .drag-handle {
            opacity: 0.7;
            transition: opacity 0.2s ease;
          }
          .main-image-badge {
            z-index: 5;
          }

          /* Visual feedback during drag */
          .image-preview-card.dragging {
            opacity: 0.5;
            transform: rotate(5deg);
          }
          .image-preview-card.drag-over {
            transform: scale(1.05);
            box-shadow: 0 8px 16px rgba(0,0,0,0.2);
            border: 2px dashed #007bff;
          }

          /* Spec sheet status transitions */
          #specSheetStatus {
            transition: all 0.3s ease;
          }
          .spec-url-section {
            transition: border-color 0.3s ease;
          }
          .spec-url-section.valid {
            border-left: 3px solid #28a745;
            padding-left: 1rem;
          }
          .spec-url-section.invalid {
            border-left: 3px solid #dc3545;
            padding-left: 1rem;
          }

          /* Content tabs styling */
          .content-tab-container {
            padding: 1rem;
            background-color: #f8f9fa;
            border-radius: 0.375rem;
            border: 1px solid #dee2e6;
          }

          #contentTabs .nav-link {
            color: #6c757d;
            border: none;
            border-bottom: 2px solid transparent;
            background: none;
            font-weight: 500;
          }

          #contentTabs .nav-link:hover {
            color: #495057;
            border-bottom-color: #dee2e6;
          }

          #contentTabs .nav-link.active {
            color: #0d6efd;
            border-bottom-color: #0d6efd;
            background: none;
          }

          .content-tab-container .btn-primary {
            background: linear-gradient(135deg, #0d6efd, #6610f2);
            border: none;
            box-shadow: 0 2px 4px rgba(13, 110, 253, 0.2);
            transition: all 0.2s ease;
          }

          .content-tab-container .btn-primary:hover {
            background: linear-gradient(135deg, #0b5ed7, #520dc2);
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(13, 110, 253, 0.3);
          }

          .content-tab-container textarea {
            border: 1px solid #ced4da;
            transition: border-color 0.15s ease, box-shadow 0.15s ease;
          }

          .content-tab-container textarea:focus {
            border-color: #86b7fe;
            box-shadow: 0 0 0 0.25rem rgba(13, 110, 253, 0.25);
          }

          /* Ensure Generate buttons are always visible */
          .content-tab-container .btn-primary {
            min-width: 100px;
            height: 36px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            z-index: 10;
            position: relative;
          }

          /* Debug: Make sure tab content is visible */
          .tab-pane {
            min-height: 200px;
          }

          .tab-pane.active {
            display: block !important;
          }

          /* Fallback: Show all tab content if Bootstrap tabs fail */
          .tab-content .tab-pane {
            display: block;
            margin-bottom: 2rem;
          }

          .tab-content .tab-pane:not(.show) {
            display: none;
          }

          /* Content completion indicators */
          .content-completion-badge .badge {
            font-size: 0.75rem;
            transition: all 0.3s ease;
          }

          .content-completion-badge .badge.bg-success {
            background-color: #28a745 !important;
            animation: pulse-success 2s ease-in-out;
          }

          .content-completion-badge .badge.bg-warning {
            background-color: #ffc107 !important;
          }

          @keyframes pulse-success {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
          }

          .tab-completion-check {
            animation: fadeInCheck 0.5s ease-in-out;
          }

          @keyframes fadeInCheck {
            0% { opacity: 0; transform: scale(0.5); }
            100% { opacity: 1; transform: scale(1); }
          }

          /* Tab hover effects with completion status */
          .nav-tabs .nav-link:has(.tab-completion-check:visible) {
            border-bottom: 2px solid #28a745;
          }

          /* Incomplete indicator styling */
          .tab-incomplete-indicator {
            transition: opacity 0.3s ease;
          }

          .tab-incomplete-indicator .fa-circle {
            animation: gentle-pulse 3s ease-in-out infinite;
          }

          @keyframes gentle-pulse {
            0%, 100% { opacity: 0.4; }
            50% { opacity: 0.8; }
          }

          /* Hide incomplete indicator when tab has content */
          .nav-link:has(.tab-completion-check[style*="inline"]) .tab-incomplete-indicator {
            display: none !important;
          }

          /* Asterisk info styling */
          .asterisk-info-badge .badge {
            font-size: 0.65rem;
            padding: 4px 8px;
            border-radius: 12px;
          }

          .asterisk-info-badge .badge.bg-info {
            background-color: #17a2b8 !important;
            color: white;
          }

          /* Special styling for asterisk tab */
          #asterisk-tab {
            position: relative;
          }

          #asterisk-tab::after {
            content: '✨';
            position: absolute;
            top: -2px;
            right: -2px;
            font-size: 0.7rem;
            opacity: 0.6;
          }

          /* Read-only pricing fields styling */
          .pricing-field-readonly {
            background-color: #f8f9fa !important;
            border: 1px solid #dee2e6 !important;
            color: #495057 !important;
            cursor: not-allowed !important;
            opacity: 0.9;
          }

          .pricing-field-readonly:focus {
            background-color: #f8f9fa !important;
            border-color: #dee2e6 !important;
            box-shadow: none !important;
          }

          /* Lock icon styling */
          .form-label .fa-lock {
            font-size: 0.8rem;
            opacity: 0.6;
          }

          /* RRP Status Indicator styling */
          .rrp-status-indicator {
            background-color: #f8f9fa !important;
            border-left: none !important;
            padding: 0.5rem;
            min-width: 45px;
            display: flex;
            align-items: center;
            justify-content: center;
          }

          .rrp-status-match {
            background-color: #d4edda !important;
            border-color: #28a745 !important;
          }

          .rrp-status-mismatch {
            background-color: #f8d7da !important;
            border-color: #dc3545 !important;
          }

          .rrp-status-unknown {
            background-color: #fff3cd !important;
            border-color: #ffc107 !important;
          }

          .rrp-status-checking {
            background-color: #e2e3e5 !important;
            border-color: #6c757d !important;
          }

          /* Status text styling */
          .rrp-status-text-match {
            color: #155724 !important;
          }

          .rrp-status-text-mismatch {
            color: #721c24 !important;
          }

          .rrp-status-text-unknown {
            color: #856404 !important;
          }

          /* Spec Sheet Status Indicators - matching RRP style */
          .spec-status-match {
            background-color: #d1edff !important;
            border-color: #28a745 !important;
          }

          .spec-status-mismatch {
            background-color: #f8d7da !important;
            border-color: #dc3545 !important;
          }

          .spec-status-unknown {
            background-color: #fff3cd !important;
            border-color: #ffc107 !important;
          }

          .spec-status-checking {
            background-color: #e2e3e5 !important;
            border-color: #6c757d !important;
          }

          /* Spec status text styling */
          .spec-status-text-match {
            color: #155724 !important;
          }

          .spec-status-text-mismatch {
            color: #721c24 !important;
          }

          .spec-status-text-unknown {
            color: #856404 !important;
          }

          .tab-content .tab-pane.show.active {
            display: block !important;
          }

          /* ===============================
             MAGICAL AI ANIMATION STYLES ✨
             =============================== */

          /* Field Group Processing State */
          .field-group.ai-processing,
          .image-section.ai-processing,
          .additional-images-section.ai-processing {
            position: relative;
            background: linear-gradient(135deg,
              rgba(138, 43, 226, 0.15),
              rgba(30, 144, 255, 0.15),
              rgba(255, 20, 147, 0.15),
              rgba(75, 0, 130, 0.15)
            ) !important;
            background-size: 400% 400% !important;
            border: 2px solid transparent !important;
            border-image: linear-gradient(45deg, #8a2be2, #1e90ff, #ff1493, #4b0082) 1 !important;
            transform: translateY(-4px) scale(1.02);
            box-shadow:
              0 0 30px rgba(138, 43, 226, 0.4),
              0 0 60px rgba(30, 144, 255, 0.3),
              0 8px 32px rgba(0, 0, 0, 0.1) !important;
            overflow: hidden;
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            animation: magicalPulse 3s ease-in-out infinite, magicalShimmer 4s linear infinite;
          }

          /* Magical floating particles effect */
          .field-group.ai-processing::before,
          .image-section.ai-processing::before,
          .additional-images-section.ai-processing::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background:
              radial-gradient(circle at 20% 80%, rgba(138, 43, 226, 0.3) 0%, transparent 50%),
              radial-gradient(circle at 80% 20%, rgba(30, 144, 255, 0.3) 0%, transparent 50%),
              radial-gradient(circle at 40% 40%, rgba(255, 20, 147, 0.2) 0%, transparent 50%);
            animation: magicalFloat 6s ease-in-out infinite;
            z-index: 0;
          }

          /* Magical energy waves */
          .field-group.ai-processing::after,
          .image-section.ai-processing::after,
          .additional-images-section.ai-processing::after {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            background: linear-gradient(45deg,
              transparent,
              rgba(138, 43, 226, 0.5),
              transparent,
              rgba(30, 144, 255, 0.5),
              transparent
            );
            background-size: 300% 300%;
            border-radius: inherit;
            animation: magicalWaves 2.5s linear infinite;
            z-index: -1;
          }

          /* Magical sparkle overlay */
          .ai-sparkles {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 2;
          }

          .ai-sparkle {
            position: absolute;
            width: 4px;
            height: 4px;
            background: radial-gradient(circle, #fff 0%, transparent 70%);
            border-radius: 50%;
            animation: sparkleFloat 3s linear infinite;
          }

          .ai-sparkle:nth-child(1) { left: 10%; top: 20%; animation-delay: 0s; }
          .ai-sparkle:nth-child(2) { left: 20%; top: 80%; animation-delay: 0.5s; }
          .ai-sparkle:nth-child(3) { left: 60%; top: 30%; animation-delay: 1s; }
          .ai-sparkle:nth-child(4) { left: 80%; top: 70%; animation-delay: 1.5s; }
          .ai-sparkle:nth-child(5) { left: 40%; top: 60%; animation-delay: 2s; }

          /* Progress Indicator - Magical energy beam */
          .ai-progress-indicator {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 6px;
            background: linear-gradient(90deg,
              transparent,
              rgba(138, 43, 226, 0.8),
              rgba(30, 144, 255, 1),
              rgba(255, 20, 147, 0.8),
              transparent
            );
            animation: magicalBeam 2s ease-in-out infinite;
            z-index: 3;
            border-radius: 3px;
            box-shadow: 0 0 10px rgba(30, 144, 255, 0.8);
          }

          /* Magic wand cursor effect */
          .field-group.ai-processing,
          .image-section.ai-processing,
          .additional-images-section.ai-processing {
            cursor: wait;
          }

          /* Magical header processing animation */
          .ai-label-processing {
            background: linear-gradient(-45deg, #8a2be2, #1e90ff, #ff1493, #4b0082) !important;
            background-size: 400% 400% !important;
            animation: magicalHeaderGlow 2s ease infinite;
            color: white !important;
            padding: 8px 16px !important;
            border-radius: 8px !important;
            font-weight: 700 !important;
            box-shadow: 0 0 20px rgba(138, 43, 226, 0.6) !important;
            text-transform: uppercase;
            letter-spacing: 1px;
          }

          @keyframes magicalHeaderGlow {
            0%, 100% {
              background-position: 0% 50%;
              box-shadow: 0 0 20px rgba(138, 43, 226, 0.6);
            }
            25% {
              background-position: 100% 50%;
              box-shadow: 0 0 25px rgba(30, 144, 255, 0.8);
            }
            50% {
              background-position: 50% 100%;
              box-shadow: 0 0 30px rgba(255, 20, 147, 0.7);
            }
            75% {
              background-position: 0% 50%;
              box-shadow: 0 0 25px rgba(75, 0, 130, 0.6);
            }
          }

          /* Keyframe Animations */
          @keyframes magicalPulse {
            0%, 100% { transform: translateY(-4px) scale(1.02); }
            50% { transform: translateY(-6px) scale(1.03); }
          }

          @keyframes magicalShimmer {
            0% { background-position: 0% 50%; }
            25% { background-position: 100% 50%; }
            50% { background-position: 50% 100%; }
            75% { background-position: 0% 50%; }
            100% { background-position: 50% 0%; }
          }

          @keyframes magicalFloat {
            0%, 100% {
              transform: translateY(0px) rotate(0deg);
              opacity: 0.7;
            }
            33% {
              transform: translateY(-10px) rotate(120deg);
              opacity: 1;
            }
            66% {
              transform: translateY(5px) rotate(240deg);
              opacity: 0.8;
            }
          }

          @keyframes magicalWaves {
            0% {
              background-position: 0% 0%;
              opacity: 0.5;
            }
            50% {
              background-position: 100% 100%;
              opacity: 0.8;
            }
            100% {
              background-position: 200% 0%;
              opacity: 0.5;
            }
          }

          @keyframes magicalBeam {
            0% {
              transform: translateX(-100%) scaleX(0);
              opacity: 0;
            }
            20% {
              transform: translateX(-50%) scaleX(0.5);
              opacity: 1;
            }
            80% {
              transform: translateX(50%) scaleX(0.5);
              opacity: 1;
            }
            100% {
              transform: translateX(100%) scaleX(0);
              opacity: 0;
            }
          }

          @keyframes sparkleFloat {
            0% {
              opacity: 0;
              transform: translateY(0px) scale(0);
            }
            20% {
              opacity: 1;
              transform: translateY(-5px) scale(1);
            }
            80% {
              opacity: 1;
              transform: translateY(-15px) scale(1);
            }
            100% {
              opacity: 0;
              transform: translateY(-20px) scale(0);
            }
          }
        </style>
        </div>


        <!-- Image Gallery Section -->
        <div class="image-section mb-4">
          <h6>
            <i class="fas fa-images me-2"></i>Product Images
            <span class="image-count-badge" id="modalImageCountBadge">0 images</span>
          </h6>

          <div class="main-image-container" id="modalMainImageContainer">
              <div class="image-placeholder" id="modalImagePlaceholder">
                  <i class="fas fa-image"></i>
                  <p>No image available</p>
              </div>

              <button class="image-nav-btn prev" id="modalPrevImageBtn" onclick="navigateModalImage(-1)" style="display: none;">
                  <i class="fas fa-chevron-left"></i>
              </button>
              <button class="image-nav-btn next" id="modalNextImageBtn" onclick="navigateModalImage(1)" style="display: none;">
                  <i class="fas fa-chevron-right"></i>
              </button>

              <div class="image-counter" id="modalImageCounter" style="display: none;">
                  <span id="modalCurrentImageIndex">1</span> / <span id="modalTotalImages">1</span>
              </div>
          </div>

          <div class="thumbnail-gallery" id="modalThumbnailGallery" style="display: none;">
              <!-- Thumbnails will be dynamically populated -->
          </div>
        </div>

        <!-- Product Form -->
        <form id="editProductForm">
          <!-- Basic Information -->
          <div class="field-group" id="basicInfoGroup">
            <h6><i class="fas fa-info-circle me-2"></i>Basic Information</h6>
            <div class="row">
              <div class="col-md-3">
                <div class="mb-3">
                  <label class="form-label">SKU</label>
                  <input type="text" class="form-control" id="editSku" placeholder="Product SKU">
                </div>
              </div>
              <div class="col-md-3">
                <div class="mb-3">
                  <label class="form-label">Product Title</label>
                  <div class="input-group">
                    <input type="text" class="form-control" id="editTitle" placeholder="Product Title">
                    <div class="btn-group">
                      <button type="button" class="btn btn-ai-generate" onclick="generateProductTitle()" title="Generate SEO-optimized title using ChatGPT">
                        <i class="fas fa-magic me-1"></i>Generate
                      </button>
                      <button type="button" class="btn btn-ai-generate dropdown-toggle dropdown-toggle-split" data-bs-toggle="dropdown" title="Advanced title generation options">
                        <span class="visually-hidden">Toggle Dropdown</span>
                      </button>
                      <ul class="dropdown-menu">
                        <li><a class="dropdown-item" href="#" onclick="generateProductTitle()">
                          <i class="fas fa-magic me-2"></i>Standard Generation
                        </a></li>
                        <li><a class="dropdown-item" href="#" onclick="generateProductTitleWithCompetitors()">
                          <i class="fas fa-search me-2"></i>With Competitor Analysis
                        </a></li>
                        <li><hr class="dropdown-divider"></li>
                        <li><a class="dropdown-item text-muted" href="#" onclick="return false;">
                          <small>Competitor analysis searches Google for similar products to optimize your titles</small>
                        </a></li>
                      </ul>
                    </div>
                  </div>
                </div>
              </div>
              <div class="col-md-3">
                <div class="mb-3">
                  <label class="form-label">Status</label>
                  <select class="form-control" id="editProductStatus">
                    <option value="">Select Status</option>
                    <option value="Active">Active</option>
                    <option value="Draft">Draft</option>
                  </select>
                </div>
              </div>
              <div class="col-md-3">
                <div class="mb-3">
                  <label class="form-label">Vendor/Brand</label>
                  <input type="text" class="form-control" id="editVendor" placeholder="Vendor Name">
                </div>
              </div>
            </div>
          </div>

          <!-- Sink Specifications -->
          <div class="field-group sink-dimensions" id="sinksSpecsGroup">
            <h6><i class="fas fa-tint me-2"></i>Sink Specifications</h6>
            <div class="row">
              <div class="col-md-4">
                <div class="mb-3">
                  <label class="form-label">Installation Type</label>
                  <select class="form-control" id="editInstallationType">
                    <option value="">Select...</option>
                    <option value="Tub & Cabinet">Tub & Cabinet</option>
                    <option value="Wallmount">Wallmount</option>
                    <option value="Topmount">Topmount</option>
                    <option value="Undermount">Undermount</option>
                    <option value="Flushmount">Flushmount</option>
                    <option value="Apron Front">Apron Front</option>
                    <option value="Apron front & Undermount">Apron front & Undermount</option>
                    <option value="Topmount & Undermount">Topmount & Undermount</option>
                    <option value="Topmount & Flushmount">Topmount & Flushmount</option>
                    <option value="Flushmount & Undermount">Flushmount & Undermount</option>
                    <option value="Undermount & Flushmount">Undermount & Flushmount</option>
                    <option value="Apron Front, Undermount & Topmount">Apron Front, Undermount & Topmount</option>
                    <option value="Undermount, Topmount, & Flushmount">Undermount, Topmount, & Flushmount</option>
                  </select>
                </div>
              </div>
              <div class="col-md-4">
                <div class="mb-3">
                  <label class="form-label">Material</label>
                  <select class="form-control" id="editProductMaterial">
                    <option value="">Select...</option>
                    <option value="Stainless Steel">Stainless Steel</option>
                    <option value="Granite">Granite</option>
                    <option value="Ceramic">Ceramic</option>
                    <option value="Fireclay">Fireclay</option>
                    <option value="Composite">Composite</option>
                    <option value="Granite Composite">Granite Composite</option>
                  </select>
                </div>
              </div>
              <div class="col-md-4">
                <div class="mb-3">
                  <label class="form-label">Material Grade</label>
                  <input type="text" class="form-control" id="editGradeOfMaterial" placeholder="Material grade/quality">
                </div>
              </div>
            </div>
            <div class="row">
              <div class="col-md-4">
                <div class="mb-3">
                  <label class="form-label">Brand Name</label>
                  <input type="text" class="form-control" id="editBrandName" placeholder="Brand/manufacturer">
                </div>
              </div>
              <div class="col-md-4">
                <div class="mb-3">
                  <label class="form-label">Style</label>
                  <select class="form-control" id="editStyle">
                    <option value="">Select Style...</option>
                    <option value="Modern">Modern</option>
                    <option value="Contemporary">Contemporary</option>
                    <option value="Traditional">Traditional</option>
                    <option value="Farmhouse">Farmhouse</option>
                    <option value="Industrial">Industrial</option>
                    <option value="Transitional">Transitional</option>
                    <option value="Minimalist">Minimalist</option>
                    <option value="Rustic">Rustic</option>
                    <option value="Classic">Classic</option>
                    <option value="Vintage">Vintage</option>
                    <option value="Outdoor Alfresco">Outdoor Alfresco</option>
                  </select>
                </div>
              </div>
              <div class="col-md-4">
                <div class="mb-3">
                  <label class="form-label">Number of Bowls</label>
                  <select class="form-control" id="editBowlsNumber" onchange="handleBowlsNumberChange()">
                    <option value="">Select...</option>
                    <option value="1">Single Bowl</option>
                    <option value="2">Double Bowl</option>
                  </select>
                </div>
              </div>
            </div>
            <div class="row">
              <div class="col-md-4">
                <div class="mb-3">
                  <label class="form-label">Tap Holes</label>
                  <input type="number" class="form-control" id="editFaucetHoles" placeholder="Number of holes">
                </div>
              </div>
              <div class="col-md-4">
                <div class="mb-3">
                  <label class="form-label">Has Overflow</label>
                  <select class="form-control" id="editHasOverflow">
                    <option value="">Select...</option>
                    <option value="Yes">Yes</option>
                    <option value="No">No</option>
                  </select>
                </div>
              </div>
              <div class="col-md-4">
                <div class="mb-3">
                  <label class="form-label">Warranty (Years)</label>
                  <input type="number" class="form-control" id="editWarrantyYears" placeholder="Years">
                </div>
              </div>
            </div>
            <div class="row">
              <div class="col-md-4">
                <div class="mb-3">
                  <label class="form-label">Waste Outlet Dimensions</label>
                  <input type="text" class="form-control" id="editWasteOutletDimensions" placeholder="e.g., 90mm">
                </div>
              </div>
              <div class="col-md-4">
                <div class="mb-3">
                  <label class="form-label">Drain Position</label>
                  <select class="form-control" id="editDrainPosition">
                    <option value="">Select...</option>
                    <option value="Center">Center</option>
                    <option value="Left">Left</option>
                    <option value="Right">Right</option>
                    <option value="Rear">Rear</option>
                  </select>
                </div>
              </div>
              <div class="col-md-4">
                <div class="mb-3">
                  <label class="form-label">Cutout Size (mm)</label>
                  <input type="text" class="form-control" id="editCutoutSizeMm" placeholder="Installation cutout size">
                </div>
              </div>
            </div>
          </div>

          <!-- Sink Dimensions -->
          <div class="field-group sink-dimensions" id="sinkDimensionsGroup">
            <h6><i class="fas fa-ruler me-2"></i>Overall Sink Dimensions</h6>
            <div class="row">
              <div class="col-md-3">
                <div class="mb-3">
                  <label class="form-label">Length (mm)</label>
                  <input type="number" class="form-control" id="editLengthMm" placeholder="Length">
                </div>
              </div>
              <div class="col-md-3">
                <div class="mb-3">
                  <label class="form-label">Width (mm)</label>
                  <input type="number" class="form-control" id="editOverallWidthMm" placeholder="Width">
                </div>
              </div>
              <div class="col-md-3">
                <div class="mb-3">
                  <label class="form-label">Depth (mm)</label>
                  <input type="number" class="form-control" id="editOverallDepthMm" placeholder="Depth">
                </div>
              </div>
              <div class="col-md-3">
                <div class="mb-3">
                  <label class="form-label">Min Cabinet (mm)</label>
                  <input type="number" class="form-control" id="editMinCabinetSizeMm" placeholder="Cabinet size">
                </div>
              </div>
            </div>
          </div>

          <!-- Bowl Dimensions -->
          <div class="field-group bowl-dimensions" id="bowlDimensionsGroup">
            <h6><i class="fas fa-circle me-2"></i>Bowl Dimensions</h6>

            <!-- Primary Bowl -->
            <div id="primaryBowlDimensions">
              <h7>Primary Bowl</h7>
              <div class="row">
                <div class="col-md-4">
                  <div class="mb-3">
                    <label class="form-label">Bowl Width (mm)</label>
                    <input type="number" class="form-control" id="editBowlWidthMm" placeholder="Bowl width">
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="mb-3">
                    <label class="form-label">Bowl Depth (mm)</label>
                    <input type="number" class="form-control" id="editBowlDepthMm" placeholder="Bowl depth">
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="mb-3">
                    <label class="form-label">Bowl Height (mm)</label>
                    <input type="number" class="form-control" id="editBowlHeightMm" placeholder="Bowl height">
                  </div>
                </div>
              </div>
            </div>

            <!-- Secondary Bowl (hidden by default) -->
            <div id="secondaryBowlDimensions" style="display: none;">
              <h7>Secondary Bowl</h7>
              <div class="row">
                <div class="col-md-4">
                  <div class="mb-3">
                    <label class="form-label">Second Bowl Width (mm)</label>
                    <input type="number" class="form-control" id="editSecondBowlWidthMm" placeholder="Second bowl width">
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="mb-3">
                    <label class="form-label">Second Bowl Depth (mm)</label>
                    <input type="number" class="form-control" id="editSecondBowlDepthMm" placeholder="Second bowl depth">
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="mb-3">
                    <label class="form-label">Second Bowl Height (mm)</label>
                    <input type="number" class="form-control" id="editSecondBowlHeightMm" placeholder="Second bowl height">
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Pricing Information -->
          <div class="field-group" id="pricingGroup">
            <h6><i class="fas fa-dollar-sign me-2"></i>Pricing Information</h6>
            <div class="row">
              <div class="col-md-6">
                <div class="mb-3">
                  <label class="form-label">
                    RRP Price ($)
                    <i class="fas fa-lock text-muted ms-1" title="Read-only field"></i>
                  </label>
                  <div class="input-group">
                    <input type="number" step="0.01" class="form-control pricing-field-readonly" id="editRrpPrice" placeholder="Recommended Retail Price" readonly>
                    <div class="input-group-append">
                      <span class="input-group-text rrp-status-indicator" id="rrpStatusIndicator">
                        <i class="fas fa-spinner fa-spin text-muted" id="rrpStatusIcon" title="Checking RRP..."></i>
                      </span>
                    </div>
                  </div>
                  <small class="form-text text-muted mt-1" id="rrpStatusText">
                    <i class="fas fa-clock me-1"></i>RRP verification pending...
                  </small>
                </div>
              </div>
              <div class="col-md-6">
                <div class="mb-3">
                  <label class="form-label">
                    Sale Price ($)
                    <i class="fas fa-lock text-muted ms-1" title="Read-only field"></i>
                  </label>
                  <input type="number" step="0.01" class="form-control pricing-field-readonly" id="editSalePrice" placeholder="Current Sale Price" readonly>
                </div>
              </div>
            </div>
            <small class="form-text text-muted mt-2">
              <i class="fas fa-info-circle me-1"></i>
              Pricing information is managed externally and cannot be edited here.
            </small>
          </div>

          <!-- Additional Information -->
          <div class="field-group" id="additionalInfoGroup">
            <h6><i class="fas fa-plus-circle me-2"></i>Additional Information</h6>
            <div class="row">
              <div class="col-md-6">
                <div class="mb-3">
                  <label class="form-label">Weight (kg)</label>
                  <input type="number" step="0.1" class="form-control" id="editWeight" placeholder="Product Weight">
                </div>
              </div>
              <div class="col-md-6">
                <div class="mb-3">
                  <label class="form-label">Application Location</label>
                  <select class="form-control" id="editApplicationLocation" multiple>
                    <option value="Kitchen">Kitchen</option>
                    <option value="Laundry">Laundry</option>
                    <option value="Bar">Bar</option>
                  </select>
                </div>
              </div>
            </div>
          </div>


          <!-- SEO Information -->
          <div class="field-group" id="seoGroup">
            <h6><i class="fas fa-search me-2"></i>SEO Information</h6>
            <div class="row">
              <div class="col-md-6">
                <div class="mb-3">
                  <label class="form-label">SEO Title</label>
                  <input type="text" class="form-control" id="editSeoTitle" placeholder="SEO optimized title">
                </div>
              </div>
              <div class="col-md-6">
                <div class="mb-3">
                  <label class="form-label">SEO Description</label>
                  <textarea class="form-control" id="editSeoDescription" rows="3" placeholder="SEO description"></textarea>
                </div>
              </div>
            </div>
          </div>

          <!-- Product Content Tabs -->
          <div class="field-group" id="contentGroup">
            <div class="d-flex justify-content-between align-items-center mb-2">
              <h6 class="mb-0"><i class="fas fa-file-text me-2"></i>Product Content</h6>
              <div class="content-completion-badge" id="contentCompletionBadge">
                <span class="badge bg-secondary" id="completionStatus">
                  <i class="fas fa-clock me-1"></i>0/5 Complete
                </span>
              </div>
            </div>

            <!-- Content Tabs Navigation -->
            <ul class="nav nav-tabs mb-3" id="contentTabs" role="tablist">
              <li class="nav-item" role="presentation">
                <button class="nav-link active" id="description-tab" data-bs-toggle="tab" data-bs-target="#description-content" type="button" role="tab" aria-controls="description-content" aria-selected="true">
                  <i class="fas fa-file-text me-1"></i>Description
                  <span class="tab-completion-check" id="description-check" style="display: none;">
                    <i class="fas fa-check-circle text-success ms-1"></i>
                  </span>
                  <span class="tab-incomplete-indicator" id="description-incomplete" style="display: inline;">
                    <i class="fas fa-circle text-danger ms-1" style="font-size: 0.5rem; opacity: 0.7;"></i>
                  </span>
                </button>
              </li>
              <li class="nav-item" role="presentation">
                <button class="nav-link" id="features-tab" data-bs-toggle="tab" data-bs-target="#features-content" type="button" role="tab" aria-controls="features-content" aria-selected="false">
                  <i class="fas fa-star me-1"></i>Key Features
                  <span class="tab-completion-check" id="features-check" style="display: none;">
                    <i class="fas fa-check-circle text-success ms-1"></i>
                  </span>
                  <span class="tab-incomplete-indicator" id="features-incomplete" style="display: inline;">
                    <i class="fas fa-circle text-danger ms-1" style="font-size: 0.5rem; opacity: 0.7;"></i>
                  </span>
                </button>
              </li>
              <li class="nav-item" role="presentation">
                <button class="nav-link" id="care-tab" data-bs-toggle="tab" data-bs-target="#care-content" type="button" role="tab" aria-controls="care-content" aria-selected="false">
                  <i class="fas fa-hand-sparkles me-1"></i>Care Instructions
                  <span class="tab-completion-check" id="care-check" style="display: none;">
                    <i class="fas fa-check-circle text-success ms-1"></i>
                  </span>
                  <span class="tab-incomplete-indicator" id="care-incomplete" style="display: inline;">
                    <i class="fas fa-circle text-danger ms-1" style="font-size: 0.5rem; opacity: 0.7;"></i>
                  </span>
                </button>
              </li>
              <li class="nav-item" role="presentation">
                <button class="nav-link" id="faqs-tab" data-bs-toggle="tab" data-bs-target="#faqs-content" type="button" role="tab" aria-controls="faqs-content" aria-selected="false">
                  <i class="fas fa-question-circle me-1"></i>FAQs
                  <span class="tab-completion-check" id="faqs-check" style="display: none;">
                    <i class="fas fa-check-circle text-success ms-1"></i>
                  </span>
                  <span class="tab-incomplete-indicator" id="faqs-incomplete" style="display: inline;">
                    <i class="fas fa-circle text-danger ms-1" style="font-size: 0.5rem; opacity: 0.7;"></i>
                  </span>
                </button>
              </li>
              <li class="nav-item" role="presentation">
                <button class="nav-link" id="asterisk-tab" data-bs-toggle="tab" data-bs-target="#asterisk-content" type="button" role="tab" aria-controls="asterisk-content" aria-selected="false">
                  <i class="fas fa-asterisk me-1"></i>Asterisk Info
                  <span class="tab-completion-check" id="asterisk-check" style="display: none;">
                    <i class="fas fa-check-circle text-success ms-1"></i>
                  </span>
                  <span class="tab-incomplete-indicator" id="asterisk-incomplete" style="display: inline;">
                    <i class="fas fa-circle text-danger ms-1" style="font-size: 0.5rem; opacity: 0.7;"></i>
                  </span>
                </button>
              </li>
            </ul>

            <!-- Content Tabs Content -->
            <div class="tab-content" id="contentTabsContent">

              <!-- Product Description Tab -->
              <div class="tab-pane fade show active" id="description-content" role="tabpanel" aria-labelledby="description-tab">
                <div class="content-tab-container">
                  <div class="d-flex justify-content-between align-items-center mb-3">
                    <label class="form-label mb-0">
                      <i class="fas fa-file-text me-2"></i>Product Description (HTML)
                    </label>
                    <button type="button" class="btn btn-primary btn-sm" onclick="generateTabContentWithAsterisk('description')">
                      <i class="fas fa-magic me-1"></i>Generate
                    </button>
                  </div>
                  <textarea class="form-control" id="editBodyHtml" rows="8" placeholder="HTML product description will be generated based on product specifications and features"></textarea>
                  <small class="form-text text-muted mt-2">
                    <i class="fas fa-info-circle me-1"></i>
                    Generates compelling HTML product description using product data, specifications, and features.
                  </small>
                </div>
              </div>

              <!-- Key Features Tab -->
              <div class="tab-pane fade" id="features-content" role="tabpanel" aria-labelledby="features-tab">
                <div class="content-tab-container">
                  <div class="d-flex justify-content-between align-items-center mb-3">
                    <label class="form-label mb-0">
                      <i class="fas fa-star me-2"></i>Key Features & Benefits
                    </label>
                    <button type="button" class="btn btn-primary btn-sm" onclick="generateTabContentWithAsterisk('features')">
                      <i class="fas fa-magic me-1"></i>Generate
                    </button>
                  </div>
                  <textarea class="form-control" id="editFeatures" rows="8" placeholder="Key product features and benefits will be generated from product specifications"></textarea>
                  <small class="form-text text-muted mt-2">
                    <i class="fas fa-info-circle me-1"></i>
                    Generates 5-7 compelling product features highlighting benefits and unique selling points.
                  </small>
                </div>
              </div>

              <!-- Care Instructions Tab -->
              <div class="tab-pane fade" id="care-content" role="tabpanel" aria-labelledby="care-tab">
                <div class="content-tab-container">
                  <div class="d-flex justify-content-between align-items-center mb-3">
                    <label class="form-label mb-0">
                      <i class="fas fa-hand-sparkles me-2"></i>Care & Maintenance Instructions
                    </label>
                    <button type="button" class="btn btn-primary btn-sm" onclick="generateTabContent('care')">
                      <i class="fas fa-magic me-1"></i>Generate
                    </button>
                  </div>
                  <textarea class="form-control" id="editCareInstructions" rows="8" placeholder="Product care and maintenance instructions will be generated based on material and product type"></textarea>
                  <small class="form-text text-muted mt-2">
                    <i class="fas fa-info-circle me-1"></i>
                    Generates specific care instructions based on product materials and usage requirements.
                  </small>
                </div>
              </div>

              <!-- FAQs Tab -->
              <div class="tab-pane fade" id="faqs-content" role="tabpanel" aria-labelledby="faqs-tab">
                <div class="content-tab-container">
                  <div class="d-flex justify-content-between align-items-center mb-3">
                    <label class="form-label mb-0">
                      <i class="fas fa-question-circle me-2"></i>Frequently Asked Questions
                    </label>
                    <button type="button" class="btn btn-primary btn-sm" onclick="generateTabContent('faqs')">
                      <i class="fas fa-magic me-1"></i>Generate
                    </button>
                  </div>
                  <textarea class="form-control" id="editFaqs" rows="8" placeholder="Product-specific FAQs will be generated based on specifications, features, and installation details"></textarea>
                  <small class="form-text text-muted mt-2">
                    <i class="fas fa-info-circle me-1"></i>
                    Generates relevant Q&As covering installation, compatibility, dimensions, and maintenance.
                  </small>
                </div>
              </div>

              <!-- Asterisk Info Tab -->
              <div class="tab-pane fade" id="asterisk-content" role="tabpanel" aria-labelledby="asterisk-tab">
                <div class="content-tab-container">
                  <div class="d-flex justify-content-between align-items-center mb-3">
                    <label class="form-label mb-0">
                      <i class="fas fa-asterisk me-2"></i>Asterisk Information
                    </label>
                    <div class="asterisk-info-badge">
                      <span class="badge bg-info">
                        <i class="fas fa-info-circle me-1"></i>Auto-added to Features & Description
                      </span>
                    </div>
                  </div>
                  <textarea class="form-control" id="editAsteriskInfo" rows="6" placeholder="Enter important customer information that will be automatically added to Key Features and Product Description.&#10;&#10;Examples:&#10;* Item does not come with waste&#10;* This item is an ex-display&#10;* Installation hardware not included&#10;* Professional installation recommended"></textarea>
                  <small class="form-text text-muted mt-2">
                    <i class="fas fa-magic me-1"></i>
                    Each line starting with "*" will be automatically added to Key Features and appended to Product Description when content is generated or regenerated.
                  </small>
                </div>
              </div>

            </div>
          </div>

          <!-- Hidden fields for compatibility with original functions -->
          <input type="hidden" id="editRowNum" value="">
          <input type="hidden" id="editCollectionName" value="sinks">
        </form>
      </div>

      <div class="modal-footer">
        <!-- Footer content removed - Data Quality moved to header -->
      </div>
    </div>
  </div>
</div>
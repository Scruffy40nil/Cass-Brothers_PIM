<!-- Beautiful Single-Page PIM Modal (Original Structure + New Design) -->
<div class="modal fade pim-modal" id="editProductModal" tabindex="-1" data-bs-backdrop="static">
  <div class="modal-dialog modal-fullscreen-lg-down modal-xl">
    <div class="modal-content pim-modal-content">

      <!-- Original Header with New Styling -->
      <div class="modal-header pim-modal-header">
        <h5 class="modal-title d-flex align-items-center">
          <i class="fas fa-edit me-2"></i>Edit Sink - <span id="editProductTitle">Product</span>
          <span id="modalStatusBadge" class="badge bg-secondary ms-3" style="display: none;">Ready</span>
          <span id="liveUpdatesBadge" class="badge bg-success ms-2" style="display: none;">
            <i class="fas fa-wifi me-1"></i>Live Updates
          </span>
        </h5>
        <div class="modal-header-actions">
          <button type="button" class="btn btn-success btn-sm me-2" onclick="console.log('🖱️ Save button clicked!'); saveProduct();" title="Save all changes to Google Sheets">
            <i class="fas fa-save me-1"></i>Save Changes
          </button>
          <button type="button" class="btn btn-ai-extract btn-sm me-2" onclick="extractSingleProductWithStatus(event)" title="AI Extract This Product">
            <i class="fas fa-robot me-1"></i>AI Extract
          </button>
          <button type="button" class="btn btn-ai-extract btn-sm me-2" onclick="extractCurrentProductImages(event)" title="Extract Images for This Product">
            <i class="fas fa-images me-1"></i>Extract Images
          </button>
          <button type="button" class="btn btn-outline-primary btn-sm me-2" id="compareButton" onclick="openCompareWindow()" style="display: none;">
            <i class="fas fa-external-link-alt me-1"></i>Compare
          </button>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
      </div>

      <!-- Original Modal Body with Beautiful Styling -->
      <div class="modal-body" style="max-height: 70vh; overflow-y: auto;">

        <!-- Pricing Comparison Section -->
        {% if collection_config.pricing_enabled %}
        <div class="pricing-section mb-4 content-card">
          <h6><i class="fas fa-dollar-sign me-2"></i>Pricing Comparison</h6>
          <div class="row">
            <div class="col-md-4">
              <div class="pricing-card">
                <div class="pricing-icon">
                  <i class="fas fa-store"></i>
                </div>
                <span class="pricing-label">Our Price</span>
                <div class="pricing-amount" id="ourCurrentPrice">$0.00</div>
                <div class="pricing-status" id="ourPriceStatus">Current pricing</div>
              </div>
            </div>
            <div class="col-md-4">
              <div class="pricing-card">
                <div class="pricing-icon">
                  <i class="fas fa-building"></i>
                </div>
                <span class="pricing-label">Competitor Price</span>
                <div class="pricing-amount" id="competitorPrice">$0.00</div>
                <div class="pricing-status" id="competitorPriceStatus">Latest comparison</div>
              </div>
            </div>
            <div class="col-md-4">
              <div class="pricing-card">
                <div class="pricing-icon">
                  <i class="fas fa-chart-line"></i>
                </div>
                <span class="pricing-label">Price Difference</span>
                <div class="pricing-amount" id="priceDifference">±$0.00</div>
                <div class="pricing-status" id="priceDifferenceStatus">Comparison status</div>
              </div>
            </div>
          </div>
        </div>
        {% endif %}

        <!-- Quality Score Display -->
        <div class="quality-score-section mb-4 content-card">
          <div class="d-flex justify-content-between align-items-center mb-3">
            <h6><i class="fas fa-star me-2"></i>Data Quality Score</h6>
            <button class="btn btn-outline-primary btn-sm" onclick="refreshQualityScore()">
              <i class="fas fa-sync me-1"></i>Refresh
            </button>
          </div>
          <div class="quality-progress-container">
            <div class="quality-score-display">
              <span class="quality-label">Overall Quality:</span>
              <div class="progress quality-progress">
                <div class="progress-bar" id="qualityProgressBar" role="progressbar" style="width: 0%"></div>
              </div>
              <span class="quality-percentage" id="qualityPercentage">0%</span>
            </div>
          </div>
          <div class="quality-details mt-2">
            <small class="text-muted" id="qualityDetailsText">Quality score based on completeness of product information</small>
          </div>
        </div>

        <!-- Product Images Section -->
        <div class="mb-4 content-card">
          <h6>
            <i class="fas fa-images me-2"></i>Product Images
            <span class="image-count-badge" id="modalImageCountBadge">0 images</span>
          </h6>

          <div class="main-image-container" id="modalMainImageContainer">
              <div class="image-placeholder" id="modalImagePlaceholder">
                  <i class="fas fa-image"></i>
                  <p>No image available</p>
              </div>

              <button class="image-nav-btn prev" id="modalPrevImageBtn" onclick="navigateModalImage(-1)" style="display: none;">
                  <i class="fas fa-chevron-left"></i>
              </button>
              <button class="image-nav-btn next" id="modalNextImageBtn" onclick="navigateModalImage(1)" style="display: none;">
                  <i class="fas fa-chevron-right"></i>
              </button>

              <div class="image-counter" id="modalImageCounter" style="display: none;">
                  <span id="modalCurrentImageIndex">1</span> / <span id="modalTotalImages">1</span>
              </div>
          </div>

          <div class="thumbnail-gallery" id="modalThumbnailGallery" style="display: none;">
              <!-- Thumbnails will be dynamically populated -->
          </div>
        </div>

        <!-- Product Form -->
        <form id="editProductForm">
          <!-- Basic Information -->
          <div class="field-group content-card" id="basicInfoGroup">
            <h6><i class="fas fa-info-circle me-2"></i>Basic Information</h6>
            <div class="row">
              <div class="col-md-4">
                <div class="mb-3">
                  <label class="form-label">SKU</label>
                  <input type="text" class="form-control" id="editSku" placeholder="Product SKU">
                </div>
              </div>
              <div class="col-md-4">
                <div class="mb-3">
                  <label class="form-label">Product Title</label>
                  <input type="text" class="form-control" id="editTitle" placeholder="Product Title">
                </div>
              </div>
              <div class="col-md-4">
                <div class="mb-3">
                  <label class="form-label">Vendor/Brand</label>
                  <input type="text" class="form-control" id="editVendor" placeholder="Vendor Name">
                </div>
              </div>
            </div>
          </div>

          <!-- Sink Specifications -->
          <div class="field-group content-card sink-dimensions" id="sinksSpecsGroup">
            <h6><i class="fas fa-tint me-2"></i>Sink Specifications</h6>
            <div class="row">
              <div class="col-md-4">
                <div class="mb-3">
                  <label class="form-label">Installation Type</label>
                  <select class="form-control" id="editInstallationType">
                    <option value="">Select...</option>
                    <option value="Undermount">Undermount</option>
                    <option value="Topmount">Topmount</option>
                    <option value="Flushmount">Flushmount</option>
                    <option value="Topmount & Undermount">Topmount & Undermount</option>
                    <option value="Topmount & Flushmount">Topmount & Flushmount</option>
                    <option value="Undermount & Flushmount">Undermount & Flushmount</option>
                  </select>
                </div>
              </div>
              <div class="col-md-4">
                <div class="mb-3">
                  <label class="form-label">Material</label>
                  <select class="form-control" id="editProductMaterial">
                    <option value="">Select...</option>
                    <option value="Stainless Steel">Stainless Steel</option>
                    <option value="Granite">Granite</option>
                    <option value="Ceramic">Ceramic</option>
                    <option value="Fireclay">Fireclay</option>
                    <option value="Composite">Composite</option>
                  </select>
                </div>
              </div>
              <div class="col-md-4">
                <div class="mb-3">
                  <label class="form-label">Material Grade</label>
                  <input type="text" class="form-control" id="editGradeOfMaterial" placeholder="Material grade/quality">
                </div>
              </div>
            </div>
            <div class="row">
              <div class="col-md-4">
                <div class="mb-3">
                  <label class="form-label">Brand Name</label>
                  <input type="text" class="form-control" id="editBrandName" placeholder="Brand/manufacturer">
                </div>
              </div>
              <div class="col-md-4">
                <div class="mb-3">
                  <label class="form-label">Style</label>
                  <input type="text" class="form-control" id="editStyle" placeholder="Style/design">
                </div>
              </div>
              <div class="col-md-4">
                <div class="mb-3">
                  <label class="form-label">Number of Bowls</label>
                  <select class="form-control" id="editBowlsNumber">
                    <option value="">Select...</option>
                    <option value="Single">Single</option>
                    <option value="Double">Double</option>
                    <option value="Triple">Triple</option>
                    <option value="1">1</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                  </select>
                </div>
              </div>
            </div>
            <div class="row">
              <div class="col-md-4">
                <div class="mb-3">
                  <label class="form-label">Tap Holes</label>
                  <select class="form-control" id="editFaucetHoles">
                    <option value="">Select...</option>
                    <option value="0">0 (No holes)</option>
                    <option value="1">1 hole</option>
                    <option value="2">2 holes</option>
                    <option value="3">3 holes</option>
                    <option value="4">4 holes</option>
                  </select>
                </div>
              </div>
              <div class="col-md-4">
                <div class="mb-3">
                  <label class="form-label">Has Overflow</label>
                  <select class="form-control" id="editHasOverflow">
                    <option value="">Select...</option>
                    <option value="Yes">Yes</option>
                    <option value="No">No</option>
                  </select>
                </div>
              </div>
              <div class="col-md-4">
                <div class="mb-3">
                  <label class="form-label">Warranty (Years)</label>
                  <input type="number" class="form-control" id="editWarrantyYears" placeholder="Years">
                </div>
              </div>
            </div>
            <div class="row">
              <div class="col-md-4">
                <div class="mb-3">
                  <label class="form-label">Waste Outlet Dimensions</label>
                  <input type="text" class="form-control" id="editWasteOutletDimensions" placeholder="Outlet size">
                </div>
              </div>
              <div class="col-md-4">
                <div class="mb-3">
                  <label class="form-label">Drain Position</label>
                  <input type="text" class="form-control" id="editDrainPosition" placeholder="Center, corner, etc.">
                </div>
              </div>
              <div class="col-md-4">
                <div class="mb-3">
                  <label class="form-label">Cutout Size (mm)</label>
                  <input type="text" class="form-control" id="editCutoutSizeMm" placeholder="Cutout dimensions">
                </div>
              </div>
            </div>
          </div>

          <!-- Physical Dimensions -->
          <div class="field-group content-card sink-dimensions" id="dimensionsGroup">
            <h6><i class="fas fa-ruler me-2"></i>Physical Dimensions</h6>
            <div class="row">
              <div class="col-md-4">
                <div class="mb-3">
                  <label class="form-label">Length (mm)</label>
                  <input type="number" class="form-control" id="editLengthMm" placeholder="Length in mm">
                </div>
              </div>
              <div class="col-md-4">
                <div class="mb-3">
                  <label class="form-label">Overall Width (mm)</label>
                  <input type="number" class="form-control" id="editOverallWidthMm" placeholder="Width in mm">
                </div>
              </div>
              <div class="col-md-4">
                <div class="mb-3">
                  <label class="form-label">Overall Depth (mm)</label>
                  <input type="number" class="form-control" id="editOverallDepthMm" placeholder="Depth in mm">
                </div>
              </div>
            </div>
            <div class="row">
              <div class="col-md-4">
                <div class="mb-3">
                  <label class="form-label">Min Cabinet Size (mm)</label>
                  <input type="text" class="form-control" id="editMinCabinetSizeMm" placeholder="Minimum cabinet size">
                </div>
              </div>
              <div class="col-md-4">
                <div class="mb-3">
                  <label class="form-label">Application Location</label>
                  <input type="text" class="form-control" id="editApplicationLocation" placeholder="Kitchen, Laundry, etc.">
                </div>
              </div>
            </div>
          </div>

          <!-- Bowl Dimensions -->
          <div class="field-group content-card bowl-dimensions" id="bowlDimensionsGroup">
            <h6><i class="fas fa-circle me-2"></i>Bowl Dimensions</h6>
            <div class="row">
              <div class="col-md-4">
                <div class="mb-3">
                  <label class="form-label">Bowl Width (mm)</label>
                  <input type="number" class="form-control" id="editBowlWidthMm" placeholder="Bowl width">
                </div>
              </div>
              <div class="col-md-4">
                <div class="mb-3">
                  <label class="form-label">Bowl Depth (mm)</label>
                  <input type="number" class="form-control" id="editBowlDepthMm" placeholder="Bowl depth">
                </div>
              </div>
              <div class="col-md-4">
                <div class="mb-3">
                  <label class="form-label">Bowl Height (mm)</label>
                  <input type="number" class="form-control" id="editBowlHeightMm" placeholder="Bowl height">
                </div>
              </div>
            </div>
            <div class="row">
              <div class="col-md-4">
                <div class="mb-3">
                  <label class="form-label">Second Bowl Width (mm)</label>
                  <input type="number" class="form-control" id="editSecondBowlWidthMm" placeholder="Second bowl width">
                </div>
              </div>
              <div class="col-md-4">
                <div class="mb-3">
                  <label class="form-label">Second Bowl Depth (mm)</label>
                  <input type="number" class="form-control" id="editSecondBowlDepthMm" placeholder="Second bowl depth">
                </div>
              </div>
              <div class="col-md-4">
                <div class="mb-3">
                  <label class="form-label">Second Bowl Height (mm)</label>
                  <input type="number" class="form-control" id="editSecondBowlHeightMm" placeholder="Second bowl height">
                </div>
              </div>
            </div>
          </div>

          <!-- E-commerce Information -->
          <div class="field-group content-card" id="ecommerceGroup">
            <h6><i class="fas fa-shopping-cart me-2"></i>E-commerce Information</h6>
            <div class="row">
              <div class="col-md-4">
                <div class="mb-3">
                  <label class="form-label">RRP Price (AUD)</label>
                  <input type="number" step="0.01" class="form-control" id="editRrpPrice" placeholder="Recommended price">
                </div>
              </div>
              <div class="col-md-4">
                <div class="mb-3">
                  <label class="form-label">Sale Price (AUD)</label>
                  <input type="number" step="0.01" class="form-control" id="editSalePrice" placeholder="Current sale price">
                </div>
              </div>
              <div class="col-md-4">
                <div class="mb-3">
                  <label class="form-label">Weight (kg)</label>
                  <input type="number" step="0.1" class="form-control" id="editWeight" placeholder="Product weight">
                </div>
              </div>
            </div>
            <div class="row">
              <div class="col-12">
                <div class="mb-3">
                  <label class="form-label">Tags (comma-separated)</label>
                  <input type="text" class="form-control" id="editTags" placeholder="tag1, tag2, tag3">
                  <small class="form-text text-muted">Use commas to separate tags</small>
                </div>
              </div>
            </div>
          </div>

          <!-- SEO Information -->
          <div class="field-group content-card" id="seoGroup">
            <h6><i class="fas fa-search me-2"></i>SEO Information</h6>
            <div class="row">
              <div class="col-md-6">
                <div class="mb-3">
                  <label class="form-label">SEO Title</label>
                  <input type="text" class="form-control" id="editSeoTitle" placeholder="SEO-optimized title" maxlength="60">
                  <small class="form-text text-muted">Max 60 characters for optimal display</small>
                </div>
              </div>
              <div class="col-md-6">
                <div class="mb-3">
                  <label class="form-label">SEO Description</label>
                  <textarea class="form-control" id="editSeoDescription" rows="3" placeholder="SEO meta description" maxlength="160"></textarea>
                  <small class="form-text text-muted">Max 160 characters for optimal display</small>
                </div>
              </div>
            </div>
          </div>

          <!-- Product Description & Content -->
          <div class="field-group content-card" id="contentGroup">
            <h6><i class="fas fa-file-text me-2"></i>Product Description & Content</h6>
            <div class="mb-3">
              <label class="form-label">Product Description (HTML)</label>
              <textarea class="form-control" id="editBodyHtml" rows="8" placeholder="Detailed product description..."></textarea>
              <small class="form-text text-muted">HTML markup supported</small>
            </div>
            <div class="mb-3">
              <label class="form-label">Key Features</label>
              <textarea class="form-control" id="editFeatures" rows="5" placeholder="• Feature 1&#10;• Feature 2&#10;• Feature 3"></textarea>
              <small class="form-text text-muted">List key product features</small>
            </div>
            <div class="mb-3">
              <label class="form-label">Care Instructions</label>
              <textarea class="form-control" id="editCareInstructions" rows="4" placeholder="How to care for this product..."></textarea>
            </div>
            <div class="mb-3">
              <label class="form-label">FAQs</label>
              <textarea class="form-control" id="editFaqs" rows="6" placeholder="Frequently asked questions and answers..."></textarea>
              <small class="form-text text-muted">FAQ content from column BF</small>
            </div>
          </div>

          <!-- Technical Documents -->
          <div class="field-group content-card" id="documentsGroup">
            <h6><i class="fas fa-file-pdf me-2"></i>Technical Documents</h6>
            <div class="mb-3">
              <label class="form-label">Specification Sheet URL</label>
              <input type="url" class="form-control" id="editShopifySpecSheet" placeholder="https://example.com/spec-sheet.pdf">
              <small class="form-text text-muted">Link to product specification sheet or manual</small>
            </div>
          </div>
        </form>
      </div>

      <!-- Original Footer -->
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        <button type="button" class="btn btn-primary" onclick="saveProduct()">
          <i class="fas fa-save me-1"></i>Save Product
        </button>
      </div>
    </div>
  </div>
</div>